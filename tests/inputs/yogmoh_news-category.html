<script>
    let highlighted = [];
    function highlight_lines(lines) {
        for (let line of highlighted) {
            let ele = document.getElementById(String(line));
            ele.style.backgroundColor = '';
        }
        highlighted = lines;
        for (let line of highlighted) {
            let ele = document.getElementById(String(line));
            ele.style.backgroundColor = 'yellow';
        }
    }
    let marked = [];
    function mark_leak_lines(lines) {
        for (let line of marked) {
            let ele = document.getElementById(String(line));
            ele.style.backgroundColor = '';
        }
        marked = lines;
        for (let line of marked) {
            let ele = document.getElementById(String(line));
            ele.style.backgroundColor = ele.style.backgroundColor = 'lightgreen';
        }
    }
    function show_infos(lines) {
        for (let line of lines) {
            let ele = document.getElementById(String(line) + "-info");
            if (ele) {
                ele.style.display = ele.style.display == 'none'? '': 'none'
            }
        }
    }
</script>
    <style type="text/css">
    .sum table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
    }

    .sum td, .sum th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
    }

    .sum tr:hover {background-color: #D6EEEE;}
</style>
<center>
<table class="sum">
  <tbody><tr>
    <th>Leakage</th>
    <th>#Detected</th>
    <th>Locations</th>
  </tr>
  <tr>
    <td>Pre-processing leakage</td>
    <td>0</td>
    <td></td>
  </tr>
  <tr>
    <td>Overlap leakage</td>
    <td>2</td>
    <td><a href="#204"><button type="button" style="line-height: 85%; None" onclick="None">204</button></a> <a href="#225"><button type="button" style="line-height: 85%; None" onclick="None">225</button></a></td>
  </tr>
  <tr>
    <td>No independence test data</td>
    <td>0</td>
    <td></td>
  </tr>
</tbody></table></center>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2021 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2021 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 145%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #ffffcc }
body { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #0000FF } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span id="2"><span class="c1"># coding: utf-8</span></span>
<span id="3"></span>
<span id="4"><span class="c1"># # Overview</span></span>
<span id="5"><span class="c1">#   From the beginning, since the first printed newspaper, every news that makes into a page has had a specific section allotted to it. Although pretty much everything changed in newspapers from the ink to the type of paper used, this proper categorization of news was carried over by generations and even to the digital versions of the newspaper. Newspaper articles are not limited to a few topics or subjects, it covers a wide range of interests from politics to sports to movies and so on. For long, this process of sectioning was done manually by people but now technology can do it without much effort. In this hackathon, Data Science and Machine Learning enthusiasts like you will use Natural Language Processing to predict which genre or category a piece of news will fall in to from the story. Size of training set: 7,628 records Size of test set: 2,748 records FEATURES: STORY:  A part of the main content of the article to be published as a piece of news. SECTION: The genre/category the STORY falls in. There are four distinct sections where each story may fall in to. </span></span>
<span id="6"><span class="c1">#   **The Sections are labelled as follows : **</span></span>
<span id="7"><span class="c1"># *       Politics: 0 </span></span>
<span id="8"><span class="c1"># *       Technology: 1 </span></span>
<span id="9"><span class="c1"># *       Entertainment: 2 </span></span>
<span id="10"><span class="c1"># *       Business: 3</span></span>
<span id="11"></span>
<span id="12"><span class="c1"># In[1]:</span></span>
<span id="13"></span>
<span id="14"></span>
<span id="15"><span class="c1"># This Python 3 environment comes with many helpful analytics libraries installed</span></span>
<span id="16"><span class="c1"># It is defined by the kaggle/python Docker image: https://github.com/kaggle/docker-python</span></span>
<span id="17"><span class="c1"># For example, here&#39;s several helpful packages to load</span></span>
<span id="18"></span>
<span id="19"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1"># linear algebra</span></span>
<span id="20"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> <span class="c1"># data processing, CSV file I/O (e.g. pd.read_csv)</span></span>
<span id="21"></span>
<span id="22"><span class="c1"># Input data files are available in the read-only &quot;../input/&quot; directory</span></span>
<span id="23"><span class="c1"># For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory</span></span>
<span id="24"></span>
<span id="25"><span class="kn">import</span> <span class="nn">os</span></span>
<span id="26"><span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">&#39;/kaggle/input&#39;</span><span class="p">):</span></span>
<span id="27">    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span></span>
<span id="28">        <span class="nb">print</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)))</span></span>
<span id="29"></span>
<span id="30"><span class="c1"># You can write up to 5GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using &quot;Save &amp; Run All&quot; </span></span>
<span id="31"><span class="c1"># You can also write temporary files to /kaggle/temp/, but they won&#39;t be saved outside of the current session</span></span>
<span id="32"></span>
<span id="33"></span>
<span id="34"><span class="c1"># In[2]:</span></span>
<span id="35"></span>
<span id="36"></span>
<span id="37"><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;pip install -U texthero&#39;</span><span class="p">)</span></span>
<span id="38"></span>
<span id="39"></span>
<span id="40"><span class="c1"># In[3]:</span></span>
<span id="41"></span>
<span id="42"></span>
<span id="43"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span></span>
<span id="44"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span>
<span id="45"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></span>
<span id="46"><span class="kn">import</span> <span class="nn">texthero</span> <span class="k">as</span> <span class="nn">hero</span></span>
<span id="47"></span>
<span id="48"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span></span>
<span id="49"><span class="kn">import</span> <span class="nn">re</span></span>
<span id="50"><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span></span>
<span id="51"></span>
<span id="52"><span class="kn">import</span> <span class="nn">nltk</span></span>
<span id="53"><span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span></span>
<span id="54"><span class="kn">from</span> <span class="nn">nltk.stem</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span></span>
<span id="55"><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span></span>
<span id="56"></span>
<span id="57"></span>
<span id="58"><span class="c1"># In[4]:</span></span>
<span id="59"></span>
<span id="60"></span>
<span id="61"><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;/kaggle/input/new-category/Data_Train.xlsx&#39;</span><span class="p">)</span></span>
<span id="62"><span class="n">test</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;/kaggle/input/new-category/Data_Test.xlsx&#39;</span><span class="p">)</span></span>
<span id="63"></span>
<span id="64"><span class="n">display</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span></span>
<span id="65"><span class="n">display</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">info</span><span class="p">())</span></span>
<span id="66"><span class="n">display</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">info</span><span class="p">())</span></span>
<span id="67"></span>
<span id="68"></span>
<span id="69"><span class="c1"># In[5]:</span></span>
<span id="70"></span>
<span id="71"></span>
<span id="72"><span class="n">train</span><span class="o">.</span><span class="n">STORY</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></span>
<span id="73"></span>
<span id="74"></span>
<span id="75"><span class="c1"># In[6]:</span></span>
<span id="76"></span>
<span id="77"></span>
<span id="78"><span class="n">train</span><span class="o">.</span><span class="n">SECTION</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="79"></span>
<span id="80"></span>
<span id="81"><span class="c1"># In[7]:</span></span>
<span id="82"></span>
<span id="83"></span>
<span id="84"><span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;SECTION&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">test</span><span class="p">])</span></span>
<span id="85"><span class="n">combined_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span></span>
<span id="86"></span>
<span id="87"></span>
<span id="88"><span class="c1"># In[8]:</span></span>
<span id="89"></span>
<span id="90"></span>
<span id="91"><span class="n">hero</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">wordcloud</span><span class="p">(</span><span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;STORY&#39;</span><span class="p">],</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;BLACK&#39;</span><span class="p">)</span></span>
<span id="92"></span>
<span id="93"></span>
<span id="94"><span class="c1"># In[9]:</span></span>
<span id="95"></span>
<span id="96"></span>
<span id="97"><span class="n">hero</span><span class="o">.</span><span class="n">Word2Vec</span></span>
<span id="98"></span>
<span id="99"></span>
<span id="100"><span class="c1"># In[10]:</span></span>
<span id="101"></span>
<span id="102"></span>
<span id="103"><span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;cleaned_text&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;STORY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_angle_brackets</span><span class="p">)</span></span>
<span id="104">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_brackets</span><span class="p">)</span></span>
<span id="105">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_curly_brackets</span><span class="p">)</span></span>
<span id="106">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_diacritics</span><span class="p">)</span></span>
<span id="107">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_digits</span><span class="p">)</span></span>
<span id="108">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_html_tags</span><span class="p">)</span></span>
<span id="109">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_punctuation</span><span class="p">)</span></span>
<span id="110">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_round_brackets</span><span class="p">)</span></span>
<span id="111">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_square_brackets</span><span class="p">)</span></span>
<span id="112">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_stopwords</span><span class="p">)</span></span>
<span id="113">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_urls</span><span class="p">)</span></span>
<span id="114">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">remove_whitespace</span><span class="p">)</span></span>
<span id="115">                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">lowercase</span><span class="p">))</span></span>
<span id="116"></span>
<span id="117"></span>
<span id="118"><span class="c1"># In[11]:</span></span>
<span id="119"></span>
<span id="120"></span>
<span id="121"><span class="n">lemm</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span></span>
<span id="122"></span>
<span id="123"><span class="k">def</span> <span class="nf">word_lemma</span><span class="p">(</span><span class="n">text</span><span class="p">):</span></span>
<span id="124">    <span class="n">words</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></span>
<span id="125">    <span class="n">lemma</span> <span class="o">=</span> <span class="p">[</span><span class="n">lemm</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">]</span></span>
<span id="126">    <span class="n">joined_text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lemma</span><span class="p">)</span></span>
<span id="127">    <span class="k">return</span> <span class="n">joined_text</span></span>
<span id="128"></span>
<span id="129"></span>
<span id="130"><span class="c1"># In[12]:</span></span>
<span id="131"></span>
<span id="132"></span>
<span id="133"><span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;lemmatized_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">cleaned_text</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">word_lemma</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></span>
<span id="134"></span>
<span id="135"></span>
<span id="136"><span class="c1"># In[13]:</span></span>
<span id="137"></span>
<span id="138"></span>
<span id="139"><span class="n">text</span> <span class="o">=</span> <span class="p">[]</span></span>
<span id="140"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">combined_df</span><span class="p">)):</span></span>
<span id="141">    <span class="n">review</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;lemmatized_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></span>
<span id="142">    <span class="n">review</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">review</span><span class="p">)</span></span>
<span id="143">    <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">review</span><span class="p">)</span></span>
<span id="144"></span>
<span id="145"></span>
<span id="146"><span class="c1"># In[14]:</span></span>
<span id="147"></span>
<span id="148"></span>
<span id="149"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span></span>
<span id="150"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span><span class="n">accuracy_score</span><span class="p">,</span><span class="n">classification_report</span><span class="p">,</span><span class="n">f1_score</span><span class="p">,</span><span class="n">plot_confusion_matrix</span></span>
<span id="151"></span>
<span id="152"><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span><span class="p">,</span><span class="n">CountVectorizer</span></span>
<span id="153"></span>
<span id="154"></span>
<span id="155"><span class="c1"># In[15]:</span></span>
<span id="156"></span>
<span id="157"></span>
<span id="158"><span class="n">X</span> <span class="o">=</span> <span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;lemmatized_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">7628</span><span class="p">]</span></span>
<span id="159"><span class="n">test_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;lemmatized_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7628</span><span class="p">:]</span></span>
<span id="160"></span>
<span id="161"></span>
<span id="162"><span class="c1"># In[16]:</span></span>
<span id="163"></span>
<span id="164"></span>
<span id="165"><span class="n">cv</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">9000</span><span class="p">)</span></span>
<span id="166"><span class="n">cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></span>
<span id="167"><span class="n">X</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></span>
<span id="168"><span class="n">test_df</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span></span>
<span id="169"></span>
<span id="170"><span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">SECTION</span></span>
<span id="171"></span>
<span id="172"></span>
<span id="173"><span class="c1"># In[17]:</span></span>
<span id="174"></span>
<span id="175"></span>
<span id="176"><span class="n">tfid</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">9000</span><span class="p">)</span></span>
<span id="177"><span class="n">tfid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></span>
<span id="178"><span class="n">X</span> <span class="o">=</span> <span class="n">tfid</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></span>
<span id="179"><span class="n">test_df</span> <span class="o">=</span> <span class="n">tfid</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span></span>
<span id="180"></span>
<span id="181"><span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">SECTION</span></span>
<span id="182"></span>
<span id="183"></span>
<span id="184"><span class="c1"># In[18]:</span></span>
<span id="185"></span>
<span id="186"></span>
<span id="187"><span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span></span>
<span id="188"><span class="n">smote</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">()</span></span>
<span id="189"><span class="n">X_new</span><span class="p">,</span><span class="n">y_new</span> <span class="o">=</span> <span class="n">smote</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></span>
<span id="190"></span>
<span id="191"></span>
<span id="192"><span class="c1"># In[19]:</span></span>
<span id="193"></span>
<span id="194"></span>
<span id="195"><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span><span class="n">stratify</span><span class="o">=</span><span class="n">y_new</span><span class="p">)</span></span>
<span id="196"></span>
<span id="197"></span>
<span id="198"><span class="c1"># In[20]:</span></span>
<span id="199"></span>
<span id="200"></span>
<span id="201"><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span></span>
<span id="202"></span>
<span id="203"><span class="n">rf</span><span class="o">=</span><span class="n">RandomForestClassifier</span><span class="p">()</span></span>
<span id="204"><span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">train</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([204, 205])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">overlap with all test data</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">no independent test data</button>
<span id="205"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">validation</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([204, 205])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">overlap with training data</button> <button type="button" style="line-height: 85%; None" onclick="mark_leak_lines([189])">potential leak src</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">used multiple times</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([205, 216, 226])">highlight other usage</button>
<span id="206"><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span></span>
<span id="207"></span>
<span id="208"></span>
<span id="209"><span class="c1"># In[21]:</span></span>
<span id="210"></span>
<span id="211"></span>
<span id="212"><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span></span>
<span id="213"></span>
<span id="214"><span class="n">xg</span><span class="o">=</span><span class="n">XGBClassifier</span><span class="p">()</span></span>
<span id="215"><span class="n">xg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">train</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([215, 216, 233])">highlight train/test sites</button>
<span id="216"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">xg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">validation</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([215, 216, 233])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">overlap with training data</button> <button type="button" style="line-height: 85%; None" onclick="mark_leak_lines([189])">potential leak src</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">used multiple times</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([205, 216, 226])">highlight other usage</button>
<span id="217"><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span></span>
<span id="218"></span>
<span id="219"></span>
<span id="220"><span class="c1"># In[22]:</span></span>
<span id="221"></span>
<span id="222"></span>
<span id="223"><span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostClassifier</span></span>
<span id="224"><span class="n">cat</span><span class="o">=</span><span class="n">CatBoostClassifier</span><span class="p">(</span><span class="n">task_type</span><span class="o">=</span><span class="s1">&#39;GPU&#39;</span><span class="p">)</span></span>
<span id="225"><span class="n">cat</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">train</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([225, 226])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">overlap with all test data</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">no independent test data</button>
<span id="226"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">validation</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([225, 226])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">overlap with training data</button> <button type="button" style="line-height: 85%; None" onclick="mark_leak_lines([189])">potential leak src</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">used multiple times</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([205, 216, 226])">highlight other usage</button>
<span id="227"><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span></span>
<span id="228"></span>
<span id="229"></span>
<span id="230"><span class="c1"># In[23]:</span></span>
<span id="231"></span>
<span id="232"></span>
<span id="233"><span class="n">predictions</span><span class="o">=</span><span class="n">xg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([215, 216, 233])">highlight train/test sites</button>
<span id="234"><span class="n">submissions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;SECTION&#39;</span><span class="p">:</span><span class="n">predictions</span><span class="p">})</span></span>
<span id="235"><span class="n">submissions</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;./sub8.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="236"></span>
<span id="237"></span>
<span id="238"><span class="c1"># In[ ]:</span></span>
</pre></div>
</td></tr></table></body>
</html>
