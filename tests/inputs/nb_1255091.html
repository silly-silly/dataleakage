<script>
    let highlighted = [];
    function highlight_lines(lines) {
        for (let line of highlighted) {
            let ele = document.getElementById(String(line));
            ele.style.backgroundColor = '';
        }
        highlighted = lines;
        for (let line of highlighted) {
            let ele = document.getElementById(String(line));
            ele.style.backgroundColor = 'yellow';
        }
    }
    let marked = [];
    function mark_leak_lines(lines) {
        for (let line of marked) {
            let ele = document.getElementById(String(line));
            ele.style.backgroundColor = '';
        }
        marked = lines;
        for (let line of marked) {
            let ele = document.getElementById(String(line));
            ele.style.backgroundColor = ele.style.backgroundColor = 'lightgreen';
        }
    }
    function show_infos(lines) {
        for (let line of lines) {
            let ele = document.getElementById(String(line) + "-info");
            if (ele) {
                ele.style.display = ele.style.display == 'none'? '': 'none'
            }
        }
    }
</script>
    <style type="text/css">
    .sum table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
    }

    .sum td, .sum th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
    }

    .sum tr:hover {background-color: #D6EEEE;}
</style>
<center>
<table class="sum">
  <tbody><tr>
    <th>Leakage</th>
    <th>#Detected</th>
    <th>Locations</th>
  </tr>
  <tr>
    <td>Pre-processing leakage</td>
    <td>4</td>
    <td><a href="#567"><button type="button" style="line-height: 85%; None" onclick="None">567</button></a> <a href="#578"><button type="button" style="line-height: 85%; None" onclick="None">578</button></a> <a href="#590"><button type="button" style="line-height: 85%; None" onclick="None">590</button></a> <a href="#617"><button type="button" style="line-height: 85%; None" onclick="None">617</button></a></td>
  </tr>
  <tr>
    <td>Overlap leakage</td>
    <td>0</td>
    <td></td>
  </tr>
  <tr>
    <td>No independence test data</td>
    <td>0</td>
    <td></td>
  </tr>
</tbody></table></center>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2021 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2021 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 145%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #ffffcc }
body { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #0000FF } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span id="2"><span class="c1"># coding: utf-8</span></span>
<span id="3"></span>
<span id="4"><span class="c1"># # Informal settlements of Syrian refugees in Lebanon</span></span>
<span id="5"><span class="c1"># </span></span>
<span id="6"><span class="c1"># ## Overview</span></span>
<span id="7"><span class="c1"># * Data was downloaded from [The Humanitarian Data Exchange](https://data.humdata.org/dataset/informal-settlements-refugees-living-in-informal-settlements)</span></span>
<span id="8"><span class="c1"># * Description from the above link: </span></span>
<span id="9"><span class="c1"># &gt; In Lebanon Syrian refugees are scattered all over the country, mostly living in the cities and villages with host communities renting or occupying abandoned or unfinished buildings, however over 30% of the refugees are living in tents in Informal Settlements. Informal Settlements are collections of tents (not more than 20 tents).</span></span>
<span id="10"><span class="c1"># </span></span>
<span id="11"><span class="c1"># ## Aims of this project</span></span>
<span id="12"><span class="c1"># * Learn how to plot maps, and visualize data on maps</span></span>
<span id="13"><span class="c1"># * Practice exploration of variables and feature cleaning </span></span>
<span id="14"><span class="c1"># * Practice machine learning and more in-depth cross-validation</span></span>
<span id="15"><span class="c1"># * packages: pandas, numpy, matplotlib, mpl_toolkits.basemap, scikit-learn</span></span>
<span id="16"><span class="c1"># </span></span>
<span id="17"><span class="c1"># ## Summary</span></span>
<span id="18"><span class="c1"># * Explored the variables in the dataset to investigate correlations with the Status of settlements. </span></span>
<span id="19"><span class="c1"># * Cleaned up data by removing NANs and irrelevant variables.</span></span>
<span id="20"><span class="c1"># * Visualized a heatmap of settlement locations on the country map using basemap.</span></span>
<span id="21"><span class="c1"># * Used Google Geocoding API to find latitude and longitude data for specific Governorates in Lebanon, then plot their locations on the map.</span></span>
<span id="22"><span class="c1"># * Mapped categorical variables into ordinals, and created new ordinal categories out of numerical variables.</span></span>
<span id="23"><span class="c1"># * Used random forest machine learning from scikit-learn to predict the status of settlements.</span></span>
<span id="24"><span class="c1"># * Ran cross-validations, and visualized ROC curves.</span></span>
<span id="25"><span class="c1"># * Explored feature importance.</span></span>
<span id="26"><span class="c1"># ___</span></span>
<span id="27"></span>
<span id="28"><span class="c1"># ## Variable definitions</span></span>
<span id="29"><span class="c1"># * **PCode**: Officially assigned PCode. This is unique to every IS. It holds the CAS (Central Administration of Statistics) Number, the IS code and the sequemtial number of the IS. Use this code to refer to the IS.  Medair assigns PCodes. This code should be used as a reference to any documentation citing an informal settlement.</span></span>
<span id="30"><span class="c1"># * **PCode Name**: P-Code based naming of the informal settlement, based on the name of the cadastral and and the site&#39;s 3 digit sequential number. This is the official name of the settlement.</span></span>
<span id="31"><span class="c1"># * **Governorate**: Governorate</span></span>
<span id="32"><span class="c1"># * **District**: District</span></span>
<span id="33"><span class="c1"># * **Cadastral Name**: Name of the Cadaster where the settlement is located</span></span>
<span id="34"><span class="c1"># * **Local Name**: Local Name of the Settlement according to NGOs working there or residents</span></span>
<span id="35"><span class="c1"># * **Latitude**: Latitude</span></span>
<span id="36"><span class="c1"># * **Longitude**: Longitude</span></span>
<span id="37"><span class="c1"># * **Shelter Type**: Informal settlement</span></span>
<span id="38"><span class="c1"># * **Status**: Active, Less than 4,Inactive, Not Willing or Erroneous</span></span>
<span id="39"><span class="c1"># * **Number of Tents**: Number of tents in the settlements verified by physical observation</span></span>
<span id="40"><span class="c1"># * **Number of Individuals**: Number of individuals living in Tents, verified by asking each tent&#39;s residents how many people sleep there each night.</span></span>
<span id="41"><span class="c1"># * **Date of the current update**: What date the update was taken - accuracy of the data is only for this particular date as settlements change frequently.</span></span>
<span id="42"><span class="c1"># * **Updated By**: Partner who undertook the update, &#39;Other&#39; if from a secondary data source and not yet verified</span></span>
<span id="43"><span class="c1"># * **Updated On**: &quot;Sweep&quot; in which the site was updated</span></span>
<span id="44"><span class="c1"># * **Discovery Date**: Calculated by running a query on all IAMP data from IAMP 1 to current IAMP to determine the first available date of update</span></span>
<span id="45"><span class="c1"># * **Date the site was created**: Date the settlement was first established</span></span>
<span id="46"><span class="c1"># * **Notes**: Any significant findings or explanation of the data</span></span>
<span id="47"><span class="c1"># 	</span></span>
<span id="48"><span class="c1"># 	</span></span>
<span id="49"><span class="c1"># * **Latrines**: Number of Latrines in the settlement.  This should be all free standing functional latrines, not just those built by NGOs, verified by physical observations.</span></span>
<span id="50"><span class="c1"># * **Water Capacity in L**: The water storage capacity availble on the site in liters. Liters of water tanks are counted and  verified by physical observations.</span></span>
<span id="51"><span class="c1"># * **Type of Water Source**: What is the primary source of water for the settlement? Verified by asking the Shawish.</span></span>
<span id="52"><span class="c1"># * **Waste Disposal**: What is the primary method of waste disposal for the settlement? Verified by asking the Shawish.</span></span>
<span id="53"><span class="c1"># * **Type of Contract**: Type of Contract between the Landlord and the refugees (Verbal, Written or None). Verified by asking the Shawish.</span></span>
<span id="54"><span class="c1"># * **Waste Water Disposal**: What is the primary method of waste water disposal for the settlement? Verified by asking the Shawish.</span></span>
<span id="55"><span class="c1"># * **Type of Internet Connection**: What kind of internet connection is used by the IS residents. Verified by asking the Shawish.</span></span>
<span id="56"><span class="c1"># * **Consultation Fee for PHC (3000/5000)**: If they know they should pay between 3000 and 5000 Lebanese Pounds for each consultation at primary health care centre. Verified by asking the Shawish.</span></span>
<span id="57"><span class="c1"># * **Free Vaccination for Children under 12**: If they know that refugee children &lt; 12 have free access to vaccination at Ministry of Health facilities. Verified by asking the Shawish.</span></span>
<span id="58"><span class="c1"># * **Number of SSBs**: Number of SSBs in the direct confines of the informal settlement. Verified by physical observation</span></span>
<span id="59"><span class="c1"># * **Number of Ind in SSBs**: Number of individuals living in SSBs, verified by asking each SSB&#39;s residents how many people sleep there each night.</span></span>
<span id="60"></span>
<span id="61"><span class="c1"># ## Question to ask</span></span>
<span id="62"><span class="c1"># Settlements have a **Status** of *Active*, *Inactive* or *Less than 4* meaning less than 4 tents exist in that location. The latter category is on the verge of becoming *Inactive*, i.e., refugees leaving the settlement, moving elsewhere, etc. </span></span>
<span id="63"><span class="c1"># ### Can we predict if a settlement is on the verge of becoming *Inactive*, i.e., if its **Status** is *Less than 4* or *Active*, based on other information in the dataset?</span></span>
<span id="64"><span class="c1"># ___</span></span>
<span id="65"></span>
<span id="66"><span class="c1"># In[1]:</span></span>
<span id="67"></span>
<span id="68"></span>
<span id="69"><span class="c1"># data analysis and wrangling</span></span>
<span id="70"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span>
<span id="71"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></span>
<span id="72"><span class="kn">import</span> <span class="nn">random</span> <span class="k">as</span> <span class="nn">rnd</span></span>
<span id="73"></span>
<span id="74"><span class="c1"># visualization</span></span>
<span id="75"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span></span>
<span id="76"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span></span>
<span id="77"><span class="kn">import</span> <span class="nn">matplotlib.colors</span></span>
<span id="78"><span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LogFormatter</span> </span>
<span id="79"><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span></span>
<span id="80"></span>
<span id="81"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> </span>
<span id="82"></span>
<span id="83"><span class="c1"># machine learning</span></span>
<span id="84"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span></span>
<span id="85"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span></span>
<span id="86"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span></span>
<span id="87"><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span><span class="p">,</span> <span class="n">LinearSVC</span></span>
<span id="88"><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span></span>
<span id="89"><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span></span>
<span id="90"><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span></span>
<span id="91"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Perceptron</span></span>
<span id="92"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDClassifier</span></span>
<span id="93"><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span> </span>
<span id="94"></span>
<span id="95"><span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span></span>
<span id="96"><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span></span>
<span id="97"><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span></span>
<span id="98"></span>
<span id="99"></span>
<span id="100"><span class="c1"># In[4]:</span></span>
<span id="101"></span>
<span id="102"></span>
<span id="103"><span class="c1"># acquire data</span></span>
<span id="104"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ListofInformalSettlements_29_DEC_2016_All_sites.csv&#39;</span><span class="p">)</span></span>
<span id="105"><span class="n">df_base</span> <span class="o">=</span> <span class="n">df</span></span>
<span id="106"></span>
<span id="107"></span>
<span id="108"><span class="c1"># In[5]:</span></span>
<span id="109"></span>
<span id="110"></span>
<span id="111"><span class="n">df_base</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span>
<span id="112"></span>
<span id="113"></span>
<span id="114"><span class="c1"># In[6]:</span></span>
<span id="115"></span>
<span id="116"></span>
<span id="117"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Governorate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span></span>
<span id="118"></span>
<span id="119"></span>
<span id="120"><span class="c1"># ## Missing governorates</span></span>
<span id="121"><span class="c1"># * Akkar Governorate is missing, and has been lumped with the North Governorate</span></span>
<span id="122"><span class="c1"># * Baalbak-Hermel Governorate is missing, and has been lumped with the Bekaa Governorate</span></span>
<span id="123"><span class="c1"># * The reason may be that the two missing governorates were only added in 2003, see http://www.localiban.org/article5075.html</span></span>
<span id="124"></span>
<span id="125"><span class="c1"># ## Heatmap of refugee informal settlement locations</span></span>
<span id="126"><span class="c1"># * Below we can see that the highest concentration of informal settlements is in the North and East of Lebanon. This is possibly because Syrian borders are located at the North and East. </span></span>
<span id="127"><span class="c1"># * No real concentration in the capital of Beirut. Could be due to the high cost of living there and a more controlled refugee management (if any).</span></span>
<span id="128"><span class="c1"># </span></span>
<span id="129"></span>
<span id="130"><span class="c1"># In[87]:</span></span>
<span id="131"></span>
<span id="132"></span>
<span id="133"><span class="kn">import</span> <span class="nn">urllib.request</span><span class="o">,</span> <span class="nn">urllib.parse</span><span class="o">,</span> <span class="nn">urllib.error</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">time</span></span>
<span id="134"></span>
<span id="135"><span class="c1"># initialize dictionary</span></span>
<span id="136"><span class="n">LocDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></span>
<span id="137"></span>
<span id="138"><span class="c1"># get Google Geocoding API</span></span>
<span id="139"><span class="n">api_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../PythonLearningSideProjects/APIs/Sarine_APIs.csv&#39;</span><span class="p">)</span></span>
<span id="140"><span class="n">google_api</span> <span class="o">=</span> <span class="n">api_table</span><span class="p">[</span><span class="s1">&#39;API key&#39;</span><span class="p">][</span><span class="n">api_table</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;google_api&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></span>
<span id="141"></span>
<span id="142"><span class="c1"># retrieve latitude and longitude for each of the Governorates and store them in a dictionary</span></span>
<span id="143"><span class="n">labeltext</span> <span class="o">=</span> <span class="n">df_base</span><span class="p">[</span><span class="s1">&#39;Governorate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span></span>
<span id="144"><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labeltext</span><span class="p">)):</span></span>
<span id="145">    <span class="n">address</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">labeltext</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; Governorate, Lebanon&quot;</span></span>
<span id="146">    <span class="n">addP</span> <span class="o">=</span> <span class="s2">&quot;address=&quot;</span> <span class="o">+</span> <span class="n">address</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;+&quot;</span><span class="p">)</span></span>
<span id="147">    <span class="n">GeoUrl</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;https://maps.googleapis.com/maps/api/geocode/json?&quot;</span> <span class="o">+</span> <span class="n">addP</span> <span class="o">+</span> <span class="s2">&quot;&amp;key=&quot;</span> <span class="o">+</span> <span class="n">google_api</span></span>
<span id="148">    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">GeoUrl</span><span class="p">)</span></span>
<span id="149">    <span class="n">jsonRaw</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></span>
<span id="150">    <span class="n">jsonData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jsonRaw</span><span class="p">)</span></span>
<span id="151">    <span class="k">if</span> <span class="n">jsonData</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;OK&#39;</span><span class="p">:</span></span>
<span id="152">        <span class="n">res</span> <span class="o">=</span> <span class="n">jsonData</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></span>
<span id="153">        <span class="n">LocDict</span><span class="p">[</span><span class="n">labeltext</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">],</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]]</span>     </span>
<span id="154">    <span class="k">else</span><span class="p">:</span></span>
<span id="155">        <span class="n">LocDict</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">}</span> <span class="c1"># this line has not been verified</span></span>
<span id="156">    </span>
<span id="157"><span class="nb">print</span><span class="p">(</span><span class="n">LocDict</span><span class="p">)</span></span>
<span id="158"></span>
<span id="159"></span>
<span id="160"><span class="c1"># In[88]:</span></span>
<span id="161"></span>
<span id="162"></span>
<span id="163"><span class="n">uppercorner</span> <span class="o">=</span> <span class="p">[</span><span class="mf">34.7</span><span class="p">,</span> <span class="mf">36.8</span><span class="p">]</span> <span class="c1">#lat, long of map upper corner</span></span>
<span id="164"><span class="n">lowercorner</span> <span class="o">=</span> <span class="p">[</span><span class="mf">33.018977</span><span class="p">,</span> <span class="mf">34.9</span><span class="p">]</span> <span class="c1">#lat, long of map lower corner</span></span>
<span id="165"></span>
<span id="166"><span class="n">xytexts</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">10</span><span class="p">)]</span> <span class="c1"># text offsets</span></span>
<span id="167"></span>
<span id="168"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span></span>
<span id="169"><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span></span>
<span id="170"><span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;merc&#39;</span><span class="p">,</span><span class="n">llcrnrlon</span><span class="o">=</span><span class="n">lowercorner</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">llcrnrlat</span><span class="o">=</span><span class="n">lowercorner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">urcrnrlon</span><span class="o">=</span><span class="n">uppercorner</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">urcrnrlat</span><span class="o">=</span><span class="n">uppercorner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_ts</span><span class="o">=</span><span class="n">lowercorner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">epsg</span><span class="o">=</span><span class="mi">22770</span><span class="p">)</span></span>
<span id="171"><span class="c1">#http://server.arcgisonline.com/arcgis/rest/services ESRI_Imagery_World_2D ESRI_StreetMap_World_2D NatGeo_World_Map</span></span>
<span id="172"></span>
<span id="173"><span class="n">m</span><span class="o">.</span><span class="n">arcgisimage</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s1">&#39;ESRI_Imagery_World_2D&#39;</span><span class="p">,</span> <span class="n">xpixels</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span></span>
<span id="174"><span class="c1">#m.drawcoastlines(linewidth=2)</span></span>
<span id="175"><span class="c1">#m.drawcountries(linewidth=2,zorder=1)</span></span>
<span id="176"><span class="n">m</span><span class="o">.</span><span class="n">drawrivers</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkcyan&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span id="177"></span>
<span id="178"><span class="n">plotvar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Ind&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Ind in SSBs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></span>
<span id="179"><span class="c1">#plotvar = df[&#39;Water Capacity in L&#39;].values</span></span>
<span id="180"><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></span>
<span id="181"></span>
<span id="182"><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labeltext</span><span class="p">)):</span></span>
<span id="183">    <span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">labelcoord</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">labelcoord</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span></span>
<span id="184">    <span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">LocDict</span><span class="p">[</span><span class="n">labeltext</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="n">LocDict</span><span class="p">[</span><span class="n">labeltext</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span></span>
<span id="185">    <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></span>
<span id="186">    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">labeltext</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">),</span><span class="n">xytext</span><span class="o">=</span><span class="n">xytexts</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span></span>
<span id="187"></span>
<span id="188"><span class="c1"># plot a scatter of the concentration of settlements in log scale</span></span>
<span id="189"><span class="n">m</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>  <span class="n">gridsize</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">mincnt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrRd_r</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span> <span class="c1"># bins=&#39;log&#39; is log colorscale and yellow is highest (http://matplotlib.org/1.2.1/examples/pylab_examples/hexbin_demo.html)</span></span>
<span id="190"><span class="n">formatter</span> <span class="o">=</span> <span class="n">LogFormatter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelOnlyBase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#,norm=matplotlib.colors.LogNorm()</span></span>
<span id="191"><span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span> <span class="c1">#format=formatter</span></span>
<span id="192"><span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Number of  settlements [log10(N)]&#39;</span><span class="p">)</span></span>
<span id="193"><span class="n">m</span><span class="o">.</span><span class="n">readshapefile</span><span class="p">(</span><span class="s1">&#39;/Users/Sarine/Documents/Sarine/Other/PythonLearningSideProjects/lebanon-refugee-data/LBN_adm/LBN_adm1&#39;</span><span class="p">,</span> <span class="s1">&#39;areas&#39;</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span></span>
<span id="194"><span class="c1">#shapefile data for Lebanon downloaded from: http://www.diva-gis.org/gdata</span></span>
<span id="195"><span class="c1">#m.areas_info contains information about each of the areas defined in shapefile</span></span>
<span id="196"></span>
<span id="197"><span class="c1"># #only plot the 6 governorates in magenta: </span></span>
<span id="198"><span class="c1"># for info, shape in zip(m.areas_info, m.areas):</span></span>
<span id="199"><span class="c1">#     if info[&#39;NAME_1&#39;] in labeltext:</span></span>
<span id="200"><span class="c1">#         x, y = zip(*shape) </span></span>
<span id="201"><span class="c1">#         m.plot(x, y, marker=None,color=&#39;m&#39;,zorder = 1)</span></span>
<span id="202">        </span>
<span id="203"></span>
<span id="204"></span>
<span id="205"><span class="c1"># In[12]:</span></span>
<span id="206"></span>
<span id="207"></span>
<span id="208"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span></span>
<span id="209"><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span></span>
<span id="210"><span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;merc&#39;</span><span class="p">,</span><span class="n">llcrnrlon</span><span class="o">=</span><span class="n">lowercorner</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">llcrnrlat</span><span class="o">=</span><span class="n">lowercorner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">urcrnrlon</span><span class="o">=</span><span class="n">uppercorner</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">urcrnrlat</span><span class="o">=</span><span class="n">uppercorner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_ts</span><span class="o">=</span><span class="n">lowercorner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">epsg</span><span class="o">=</span><span class="mi">22770</span><span class="p">)</span></span>
<span id="211"><span class="c1">#http://server.arcgisonline.com/arcgis/rest/services</span></span>
<span id="212"></span>
<span id="213"><span class="n">m</span><span class="o">.</span><span class="n">arcgisimage</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s1">&#39;ESRI_Imagery_World_2D&#39;</span><span class="p">,</span> <span class="n">xpixels</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span></span>
<span id="214"><span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></span>
<span id="215"><span class="n">m</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span id="216"></span>
<span id="217"><span class="n">plotvar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Ind&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Ind in SSBs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></span>
<span id="218"><span class="c1">#plotvar = df[&#39;Number of Latrines&#39;].values</span></span>
<span id="219"><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></span>
<span id="220"><span class="n">m</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">plotvar</span><span class="p">,</span> <span class="n">reduce_C_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="n">mincnt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrRd_r</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">());</span> <span class="c1"># bins=&#39;log&#39; is log colorscale and yellow is highest (http://matplotlib.org/1.2.1/examples/pylab_examples/hexbin_demo.html)</span></span>
<span id="221"><span class="n">formatter</span> <span class="o">=</span> <span class="n">LogFormatter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelOnlyBase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#,norm=matplotlib.colors.LogNorm()</span></span>
<span id="222"><span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">formatter</span><span class="p">)</span> <span class="c1">#format=formatter</span></span>
<span id="223"><span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span> <span class="n">update_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="224"><span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;10&#39;</span><span class="p">,</span><span class="s1">&#39;50&#39;</span><span class="p">,</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="s1">&#39;500&#39;</span><span class="p">],</span> <span class="n">update_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="225"><span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Mean number of people in settlements&#39;</span><span class="p">)</span></span>
<span id="226"></span>
<span id="227"><span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span></span>
<span id="228"><span class="n">m1</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;merc&#39;</span><span class="p">,</span><span class="n">llcrnrlon</span><span class="o">=</span><span class="n">lowercorner</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">llcrnrlat</span><span class="o">=</span><span class="n">lowercorner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">urcrnrlon</span><span class="o">=</span><span class="n">uppercorner</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">urcrnrlat</span><span class="o">=</span><span class="n">uppercorner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_ts</span><span class="o">=</span><span class="n">lowercorner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">epsg</span><span class="o">=</span><span class="mi">22770</span><span class="p">)</span></span>
<span id="229"><span class="c1">#http://server.arcgisonline.com/arcgis/rest/services</span></span>
<span id="230"></span>
<span id="231"><span class="n">m1</span><span class="o">.</span><span class="n">arcgisimage</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s1">&#39;ESRI_Imagery_World_2D&#39;</span><span class="p">,</span> <span class="n">xpixels</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span></span>
<span id="232"><span class="n">m1</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></span>
<span id="233"><span class="n">m1</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span id="234"></span>
<span id="235"><span class="c1">#plotvar = df[&#39;Number of Ind&#39;].values+df[&#39;Number of Ind in SSBs&#39;].values</span></span>
<span id="236"><span class="n">plotvar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Water Capacity in L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></span>
<span id="237"><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m1</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></span>
<span id="238"><span class="n">m1</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">plotvar</span><span class="p">,</span> <span class="n">reduce_C_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="n">mincnt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrRd_r</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">());</span> <span class="c1"># bins=&#39;log&#39; is log colorscale and yellow is highest (http://matplotlib.org/1.2.1/examples/pylab_examples/hexbin_demo.html)</span></span>
<span id="239"><span class="n">formatter</span> <span class="o">=</span> <span class="n">LogFormatter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelOnlyBase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#,norm=matplotlib.colors.LogNorm()</span></span>
<span id="240"><span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span> <span class="c1">#format=formatter</span></span>
<span id="241"><span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">50000</span><span class="p">],</span> <span class="n">update_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="242"><span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;10&#39;</span><span class="p">,</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="s1">&#39;1000&#39;</span><span class="p">,</span><span class="s1">&#39;10000&#39;</span><span class="p">,</span><span class="s1">&#39;50000&#39;</span><span class="p">],</span> <span class="n">update_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="243"><span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Water capacity in L&#39;</span><span class="p">)</span></span>
<span id="244"></span>
<span id="245"></span>
<span id="246"><span class="c1"># In[13]:</span></span>
<span id="247"></span>
<span id="248"></span>
<span id="249"><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span></span>
<span id="250"></span>
<span id="251"></span>
<span id="252"><span class="c1"># ## Exploratory analysis and data cleaning</span></span>
<span id="253"><span class="c1"># * Can we predict from location data, water capacity, etc. if the **Status** is *Active* or *Less than 4*?</span></span>
<span id="254"><span class="c1"># * Remove *Inactive*, *Erroneous* and *Not Willing*; set *Less than 4* to 0, and *Active* to 1</span></span>
<span id="255"><span class="c1"># * Possible features to explore: **Number of Ind** (range?), **Water Capacity in L** (range), **Waste Disposal**, **Waste Water Disposal**, **Number of Latrines**, **District** or **Governorate**, Length of site creation, **Number of SSBs**, **Type of Water Source**, **Type of Contract**, **Type of Internet Connection**.</span></span>
<span id="256"></span>
<span id="257"><span class="c1"># In[14]:</span></span>
<span id="258"></span>
<span id="259"></span>
<span id="260"><span class="c1">#drop Inactive, Erroneous and Not Willing rows from Status:</span></span>
<span id="261"><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;Inactive&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="262"><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;Erroneous&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="263"><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;Not Willing&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="264"></span>
<span id="265"></span>
<span id="266"><span class="c1"># In[15]:</span></span>
<span id="267"></span>
<span id="268"></span>
<span id="269"><span class="c1"># map Status onto 0/1:</span></span>
<span id="270"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;Active&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Less than 4&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span id="271"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="272"></span>
<span id="273"></span>
<span id="274"><span class="c1"># ### Missing values</span></span>
<span id="275"><span class="c1"># * Type of Water Source has 63 missing values</span></span>
<span id="276"><span class="c1"># * Waste Disposal has 66 missing values</span></span>
<span id="277"><span class="c1"># * Waste Water Disposal has 152 missing values</span></span>
<span id="278"><span class="c1"># * Type of Contract has 99 missing values</span></span>
<span id="279"><span class="c1"># * Type of Internet Connection has 450 missing values</span></span>
<span id="280"></span>
<span id="281"><span class="c1"># In[16]:</span></span>
<span id="282"></span>
<span id="283"></span>
<span id="284"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></span>
<span id="285"></span>
<span id="286"></span>
<span id="287"><span class="c1"># In[17]:</span></span>
<span id="288"></span>
<span id="289"></span>
<span id="290"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Disposal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></span>
<span id="291"></span>
<span id="292"></span>
<span id="293"><span class="c1"># In[18]:</span></span>
<span id="294"></span>
<span id="295"></span>
<span id="296"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></span>
<span id="297"></span>
<span id="298"></span>
<span id="299"><span class="c1"># In[19]:</span></span>
<span id="300"></span>
<span id="301"></span>
<span id="302"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Contract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></span>
<span id="303"></span>
<span id="304"></span>
<span id="305"><span class="c1"># In[20]:</span></span>
<span id="306"></span>
<span id="307"></span>
<span id="308"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Internet Connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></span>
<span id="309"></span>
<span id="310"></span>
<span id="311"><span class="c1"># In[21]:</span></span>
<span id="312"></span>
<span id="313"></span>
<span id="314"><span class="c1">#Drop NAN in all of the above (later: can use the median to replace):</span></span>
<span id="315"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></span>
<span id="316"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Waste Disposal&#39;</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></span>
<span id="317"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></span>
<span id="318"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Type of Contract&#39;</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></span>
<span id="319"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Type of Internet Connection&#39;</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></span>
<span id="320"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="321"></span>
<span id="322"></span>
<span id="323"><span class="c1"># ### Some visualization</span></span>
<span id="324"></span>
<span id="325"><span class="c1"># In[22]:</span></span>
<span id="326"></span>
<span id="327"></span>
<span id="328"><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">)</span></span>
<span id="329"><span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="s1">&#39;Water Capacity in L&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></span>
<span id="330"></span>
<span id="331"></span>
<span id="332"><span class="c1"># Water capacity close to 0 in Less than 4 category.</span></span>
<span id="333"></span>
<span id="334"><span class="c1"># In[23]:</span></span>
<span id="335"></span>
<span id="336"></span>
<span id="337"><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">)</span></span>
<span id="338"><span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="s1">&#39;Number of Latrines&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></span>
<span id="339"></span>
<span id="340"></span>
<span id="341"><span class="c1"># In[24]:</span></span>
<span id="342"></span>
<span id="343"></span>
<span id="344"><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">)</span></span>
<span id="345"><span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="s1">&#39;Number of SSBs&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></span>
<span id="346"></span>
<span id="347"></span>
<span id="348"><span class="c1"># In[25]:</span></span>
<span id="349"></span>
<span id="350"></span>
<span id="351"><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">)</span></span>
<span id="352"><span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="s1">&#39;Number of Ind in SSBs&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></span>
<span id="353"></span>
<span id="354"></span>
<span id="355"><span class="c1"># In[26]:</span></span>
<span id="356"></span>
<span id="357"></span>
<span id="358"><span class="c1"># map Waste Disposal onto 1, 2, or 3 (lump Bury it with Dump it outside the camp):</span></span>
<span id="359"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Disposal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Disposal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;Municipality Collection&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Burn it&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Dump it outside the camp&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Burry it&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span id="360"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span>
<span id="361"></span>
<span id="362"></span>
<span id="363"><span class="c1"># In[27]:</span></span>
<span id="364"></span>
<span id="365"></span>
<span id="366"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="367"></span>
<span id="368"></span>
<span id="369"><span class="c1"># In[28]:</span></span>
<span id="370"></span>
<span id="371"></span>
<span id="372"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;Storm water channel&#39;</span><span class="p">,</span> <span class="s1">&#39;Septic tank&#39;</span><span class="p">,</span><span class="s1">&#39;Municipality sewer network / treated&#39;</span><span class="p">,</span>                                                                 <span class="s1">&#39;Irrigation canal&#39;</span><span class="p">],</span> <span class="s1">&#39;Rare&#39;</span><span class="p">)</span></span>
<span id="373"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="374"></span>
<span id="375"></span>
<span id="376"><span class="c1"># In[29]:</span></span>
<span id="377"></span>
<span id="378"></span>
<span id="379"><span class="c1"># map Waste Water Disposal into 1, 2, 3, 4, or 5:</span></span>
<span id="380"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;Direct discharge to environment&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Cesspit&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Open pit&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Holding tank&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Municipality sewer network / not treated&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Rare&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span id="381"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="382"></span>
<span id="383"></span>
<span id="384"><span class="c1"># In[30]:</span></span>
<span id="385"></span>
<span id="386"></span>
<span id="387"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Governorate&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Governorate&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span id="388"><span class="c1">#do not take Governorate as feature?</span></span>
<span id="389"></span>
<span id="390"></span>
<span id="391"><span class="c1"># In[31]:</span></span>
<span id="392"></span>
<span id="393"></span>
<span id="394"><span class="c1"># map Waste Water Disposal into 1, 2, 3, 4, or 5:</span></span>
<span id="395"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Governorate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Governorate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;Bekaa&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;North&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;South&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Mount Lebanon&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Nabatiye&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Beirut&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span id="396"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Governorate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="397"></span>
<span id="398"></span>
<span id="399"><span class="c1"># In[32]:</span></span>
<span id="400"></span>
<span id="401"></span>
<span id="402"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;District&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;District&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span id="403"><span class="c1">#do not take District as feature</span></span>
<span id="404"></span>
<span id="405"></span>
<span id="406"><span class="c1"># In[33]:</span></span>
<span id="407"></span>
<span id="408"></span>
<span id="409"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Waste Disposal&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Waste Disposal&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span id="410"><span class="c1">#do not take Waste Disposal as feature</span></span>
<span id="411"></span>
<span id="412"></span>
<span id="413"><span class="c1"># In[34]:</span></span>
<span id="414"></span>
<span id="415"></span>
<span id="416"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span id="417"><span class="c1">#take Waste Water Disposal as feature?</span></span>
<span id="418"></span>
<span id="419"></span>
<span id="420"><span class="c1"># In[35]:</span></span>
<span id="421"></span>
<span id="422"></span>
<span id="423"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="424"></span>
<span id="425"></span>
<span id="426"><span class="c1"># In[36]:</span></span>
<span id="427"></span>
<span id="428"></span>
<span id="429"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;Spring&#39;</span><span class="p">,</span> <span class="s1">&#39;Well&#39;</span><span class="p">,</span><span class="s1">&#39;Others&#39;</span><span class="p">,</span>                                                                 <span class="s1">&#39;River&#39;</span><span class="p">],</span> <span class="s1">&#39;Rare&#39;</span><span class="p">)</span></span>
<span id="430"></span>
<span id="431"></span>
<span id="432"><span class="c1"># In[37]:</span></span>
<span id="433"></span>
<span id="434"></span>
<span id="435"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span id="436"><span class="c1">#we *could* take this one as a feature</span></span>
<span id="437"></span>
<span id="438"></span>
<span id="439"><span class="c1"># In[38]:</span></span>
<span id="440"></span>
<span id="441"></span>
<span id="442"><span class="c1"># map Type of Water Source into 1, 2, 3, or 4:</span></span>
<span id="443"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;Water Trucking&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Borehole&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Water Network&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Rare&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span id="444"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="445"></span>
<span id="446"></span>
<span id="447"><span class="c1"># In[39]:</span></span>
<span id="448"></span>
<span id="449"></span>
<span id="450"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Contract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="451"></span>
<span id="452"></span>
<span id="453"><span class="c1"># In[40]:</span></span>
<span id="454"></span>
<span id="455"></span>
<span id="456"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Type of Contract&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Type of Contract&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span id="457"><span class="c1"># this is a good feature</span></span>
<span id="458"></span>
<span id="459"></span>
<span id="460"><span class="c1"># In[41]:</span></span>
<span id="461"></span>
<span id="462"></span>
<span id="463"><span class="c1"># map Type of Contract into 1, 2, or 3:</span></span>
<span id="464"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Contract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Contract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;Verbal&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Written&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span id="465"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Contract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="466"></span>
<span id="467"></span>
<span id="468"><span class="c1"># In[42]:</span></span>
<span id="469"></span>
<span id="470"></span>
<span id="471"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Internet Connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="472"></span>
<span id="473"></span>
<span id="474"><span class="c1"># In[43]:</span></span>
<span id="475"></span>
<span id="476"></span>
<span id="477"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Type of Internet Connection&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Type of Internet Connection&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span id="478"><span class="c1">#possible feature</span></span>
<span id="479"></span>
<span id="480"></span>
<span id="481"><span class="c1"># In[44]:</span></span>
<span id="482"></span>
<span id="483"></span>
<span id="484"><span class="c1"># map Type of Internet Connection into 1, 2, or 3:</span></span>
<span id="485"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Internet Connection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Internet Connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;Mobile network - 3G / 4G&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Wifi  / local Internet service provider&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;No Internet access&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span id="486"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Type of Internet Connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span id="487"></span>
<span id="488"></span>
<span id="489"><span class="c1"># In[45]:</span></span>
<span id="490"></span>
<span id="491"></span>
<span id="492"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Consultation Fee for PHC (3000/5000)&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Consultation Fee for PHC (3000/5000)&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span id="493"><span class="c1">#not a good feature</span></span>
<span id="494"></span>
<span id="495"></span>
<span id="496"><span class="c1"># In[46]:</span></span>
<span id="497"></span>
<span id="498"></span>
<span id="499"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Free Vaccination for Children under 12&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Free Vaccination for Children under 12&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span id="500"><span class="c1">#not a good feature</span></span>
<span id="501"></span>
<span id="502"></span>
<span id="503"><span class="c1"># In[47]:</span></span>
<span id="504"></span>
<span id="505"></span>
<span id="506"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LatrinesBand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Latrines&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span></span>
<span id="507"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;LatrinesBand&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;LatrinesBand&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;LatrinesBand&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="508"></span>
<span id="509"></span>
<span id="510"><span class="c1"># In[48]:</span></span>
<span id="511"></span>
<span id="512"></span>
<span id="513"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Latrines&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;LatrinesBandNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></span>
<span id="514"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Latrines&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Latrines&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;LatrinesBandNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></span>
<span id="515"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Latrines&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Latrines&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">),</span> <span class="s1">&#39;LatrinesBandNum&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">2</span></span>
<span id="516"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Latrines&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;LatrinesBandNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span></span>
<span id="517"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LatrinesBandNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;LatrinesBandNum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span id="518"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;LatrinesBand&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span id="519"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span>
<span id="520"></span>
<span id="521"></span>
<span id="522"><span class="c1"># In[49]:</span></span>
<span id="523"></span>
<span id="524"></span>
<span id="525"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;WaterBand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Water Capacity in L&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span></span>
<span id="526"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;WaterBand&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;WaterBand&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;WaterBand&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span id="527"></span>
<span id="528"></span>
<span id="529"><span class="c1"># In[50]:</span></span>
<span id="530"></span>
<span id="531"></span>
<span id="532"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Water Capacity in L&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;WaterBandNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></span>
<span id="533"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Water Capacity in L&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Water Capacity in L&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2500</span><span class="p">),</span> <span class="s1">&#39;WaterBandNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></span>
<span id="534"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Water Capacity in L&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Water Capacity in L&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">7000</span><span class="p">),</span> <span class="s1">&#39;WaterBandNum&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">2</span></span>
<span id="535"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Water Capacity in L&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">7000</span><span class="p">,</span> <span class="s1">&#39;WaterBandNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span></span>
<span id="536"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;WaterBandNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;WaterBandNum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span id="537"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;WaterBand&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span id="538"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span>
<span id="539"></span>
<span id="540"></span>
<span id="541"><span class="c1"># ### Features to keep : </span></span>
<span id="542"><span class="c1"># **Water Capacity in L** (range), **Waste Water Disposal** (maybe), **Number of Latrines**, **Type of Water Source**, **Type of Contract**, **Type of Internet Connection**.</span></span>
<span id="543"></span>
<span id="544"><span class="c1"># In[51]:</span></span>
<span id="545"></span>
<span id="546"></span>
<span id="547"><span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span><span class="s1">&#39;Waste Water Disposal&#39;</span><span class="p">,</span><span class="s1">&#39;Type of Water Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Type of Contract&#39;</span><span class="p">,</span><span class="s1">&#39;Type of Internet Connection&#39;</span><span class="p">,</span><span class="s1">&#39;LatrinesBandNum&#39;</span><span class="p">,</span><span class="s1">&#39;WaterBandNum&#39;</span><span class="p">,</span><span class="s1">&#39;Governorate&#39;</span><span class="p">]]</span></span>
<span id="548"><span class="n">df1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span>
<span id="549"></span>
<span id="550"></span>
<span id="551"><span class="c1"># ## Machine Learning</span></span>
<span id="552"></span>
<span id="553"><span class="c1"># In[52]:</span></span>
<span id="554"></span>
<span id="555"></span>
<span id="556"><span class="n">df_x</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="c1">#all the data except labels</span></span>
<span id="557"><span class="n">df_y</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#the labels</span></span>
<span id="558"><span class="n">x_train</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df_x</span><span class="p">,</span><span class="n">df_y</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span></span>
<span id="559"></span>
<span id="560"></span>
<span id="561"><span class="c1"># In[53]:</span></span>
<span id="562"></span>
<span id="563"></span>
<span id="564"><span class="c1"># Decision Tree</span></span>
<span id="565"><span class="n">decision_tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span></span>
<span id="566"><span class="n">decision_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">train</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([566, 567, 568])">highlight train/test sites</button>
<span id="567"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">decision_tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([566, 567, 568])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">potential preprocessing leakage</button> <a href="#506"><button type="button" style="line-height: 85%; None" onclick="mark_leak_lines([506, 525])">show and go to first leak src</button></a>
<span id="568"><span class="n">acc_decision_tree</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">decision_tree</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">validation</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([566, 567, 568])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">overlap with training data</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">used multiple times</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([568, 579, 591, 592])">highlight other usage</button>
<span id="569"><span class="n">acc_decision_tree</span></span>
<span id="570"></span>
<span id="571"></span>
<span id="572"><span class="c1"># In[54]:</span></span>
<span id="573"></span>
<span id="574"></span>
<span id="575"><span class="c1"># k-Nearest Neighbors</span></span>
<span id="576"><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span></span>
<span id="577"><span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">train</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([577, 578, 579])">highlight train/test sites</button>
<span id="578"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([577, 578, 579])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">potential preprocessing leakage</button> <a href="#506"><button type="button" style="line-height: 85%; None" onclick="mark_leak_lines([506, 525])">show and go to first leak src</button></a>
<span id="579"><span class="n">acc_knn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">validation</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([577, 578, 579])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">overlap with training data</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">used multiple times</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([568, 579, 591, 592])">highlight other usage</button>
<span id="580"><span class="n">acc_knn</span></span>
<span id="581"></span>
<span id="582"></span>
<span id="583"><span class="c1"># In[55]:</span></span>
<span id="584"></span>
<span id="585"></span>
<span id="586"><span class="c1"># Random Forest</span></span>
<span id="587"><span class="n">random_forest</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></span>
<span id="588"><span class="n">RF_fit</span> <span class="o">=</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">train</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([588, 590, 591, 592])">highlight train/test sites</button>
<span id="589"><span class="c1">#y_pred = random_forest.predict(x_test)</span></span>
<span id="590"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF_fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([588, 590, 591, 592])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">potential preprocessing leakage</button> <a href="#506"><button type="button" style="line-height: 85%; None" onclick="mark_leak_lines([506, 525])">show and go to first leak src</button></a>
<span id="591"><span class="n">random_forest</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">validation</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([588, 590, 591, 592])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">overlap with training data</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">used multiple times</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([568, 579, 591])">highlight other usage</button>
<span id="592"><span class="n">acc_random_forest</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random_forest</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">validation</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([588, 590, 591, 592])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">overlap with training data</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">used multiple times</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([568, 579, 592])">highlight other usage</button>
<span id="593"><span class="n">acc_random_forest</span></span>
<span id="594"></span>
<span id="595"></span>
<span id="596"><span class="c1"># ### Cross-validation</span></span>
<span id="597"></span>
<span id="598"><span class="c1"># In[56]:</span></span>
<span id="599"></span>
<span id="600"></span>
<span id="601"><span class="c1">#CV</span></span>
<span id="602"><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">random_forest</span><span class="p">,</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1">#,scoring=&#39;f1_macro&#39;</span></span>
<span id="603"><span class="nb">print</span><span class="p">((</span><span class="s2">&quot;Accuracy: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)))</span></span>
<span id="604"></span>
<span id="605"></span>
<span id="606"><span class="c1"># In[57]:</span></span>
<span id="607"></span>
<span id="608"></span>
<span id="609"><span class="c1">#transforming features</span></span>
<span id="610"><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span></span>
<span id="611"><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df_x</span><span class="p">,</span> <span class="n">df_y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></span>
<span id="612"><span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span></span>
<span id="613"><span class="n">X_train_transformed</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span></span>
<span id="614"><span class="c1">#clf = SVC(C=1).fit(X_train_transformed, y_train)</span></span>
<span id="615"><span class="n">clf</span> <span class="o">=</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_transformed</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">train</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([615, 617])">highlight train/test sites</button>
<span id="616"><span class="n">X_test_transformed</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span></span>
<span id="617"><span class="n">clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_transformed</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>  </span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([615, 617])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">potential preprocessing leakage</button> <a href="#506"><button type="button" style="line-height: 85%; None" onclick="mark_leak_lines([506, 525])">show and go to first leak src</button></a>
<span id="618"></span>
<span id="619"></span>
<span id="620"><span class="c1"># In[58]:</span></span>
<span id="621"></span>
<span id="622"></span>
<span id="623"><span class="c1">#using a pipeline to transform features</span></span>
<span id="624"><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span></span>
<span id="625"><span class="n">clf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></span>
<span id="626"><span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">df_x</span><span class="p">,</span> <span class="n">df_y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></span>
<span id="627"></span>
<span id="628"></span>
<span id="629"><span class="c1"># In[59]:</span></span>
<span id="630"></span>
<span id="631"></span>
<span id="632"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_predict</span></span>
<span id="633"><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span></span>
<span id="634"><span class="n">predicted</span> <span class="o">=</span> <span class="n">cross_val_predict</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">df_x</span><span class="p">,</span> <span class="n">df_y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></span>
<span id="635"><span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">df_y</span><span class="p">,</span> <span class="n">predicted</span><span class="p">)</span> </span>
<span id="636"></span>
<span id="637"></span>
<span id="638"><span class="c1"># ### ROC curves of cross-validation folds</span></span>
<span id="639"></span>
<span id="640"><span class="c1"># In[60]:</span></span>
<span id="641"></span>
<span id="642"></span>
<span id="643"><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interp</span></span>
<span id="644"><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span></span>
<span id="645"></span>
<span id="646"><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">svm</span><span class="p">,</span> <span class="n">datasets</span></span>
<span id="647"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span></span>
<span id="648"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span></span>
<span id="649"></span>
<span id="650"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span></span>
<span id="651"></span>
<span id="652"><span class="n">X</span> <span class="o">=</span> <span class="n">df_x</span></span>
<span id="653"><span class="n">y</span> <span class="o">=</span> <span class="n">df_y</span></span>
<span id="654"></span>
<span id="655"><span class="n">n_samples</span><span class="p">,</span> <span class="n">n_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span></span>
<span id="656"></span>
<span id="657"><span class="c1"># Add noisy features</span></span>
<span id="658"><span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span>
<span id="659"><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">random_state</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="mi">200</span> <span class="o">*</span> <span class="n">n_features</span><span class="p">)]</span></span>
<span id="660"></span>
<span id="661"><span class="c1"># Run classifier with cross-validation and plot ROC curves</span></span>
<span id="662"><span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span></span>
<span id="663"><span class="c1">#classifier = svm.SVC(kernel=&#39;linear&#39;, probability=True, random_state=random_state) </span></span>
<span id="664"><span class="n">classifier</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span></span>
<span id="665"><span class="n">mean_tpr</span> <span class="o">=</span> <span class="mf">0.0</span></span>
<span id="666"><span class="n">mean_fpr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span></span>
<span id="667"></span>
<span id="668"><span class="n">colors</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">([</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;indigo&#39;</span><span class="p">,</span> <span class="s1">&#39;seagreen&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;darkorange&#39;</span><span class="p">])</span></span>
<span id="669"><span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span></span>
<span id="670"></span>
<span id="671"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span></span>
<span id="672"><span class="k">for</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">),</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">colors</span><span class="p">):</span></span>
<span id="673">    <span class="n">probas_</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train</span><span class="p">])</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">test</span><span class="p">])</span></span> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">train</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([673, 673])">highlight train/test sites</button> <button type="button" style="line-height: 85%; background-color: red; color: white; border:none;" onclick="None">no independent test data</button> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">test</button> <button type="button" style="line-height: 85%; background-color: green; color: white; border:none;" onclick="None">validation</button> <button type="button" style="line-height: 85%; None" onclick="highlight_lines([673, 673])">highlight train/test sites</button>
<span id="674">    <span class="c1"># Compute ROC curve and area under the curve</span></span>
<span id="675">    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">probas_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span></span>
<span id="676">    <span class="n">mean_tpr</span> <span class="o">+=</span> <span class="n">interp</span><span class="p">(</span><span class="n">mean_fpr</span><span class="p">,</span> <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span></span>
<span id="677">    <span class="n">mean_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></span>
<span id="678">    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span></span>
<span id="679">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span></span>
<span id="680">             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ROC fold </span><span class="si">%d</span><span class="s1"> (area = </span><span class="si">%0.2f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">))</span></span>
<span id="681"></span>
<span id="682">    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></span>
<span id="683"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span></span>
<span id="684">         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Luck&#39;</span><span class="p">)</span></span>
<span id="685"></span>
<span id="686"><span class="n">mean_tpr</span> <span class="o">/=</span> <span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></span>
<span id="687"><span class="n">mean_tpr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span></span>
<span id="688"><span class="n">mean_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">mean_fpr</span><span class="p">,</span> <span class="n">mean_tpr</span><span class="p">)</span></span>
<span id="689"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_fpr</span><span class="p">,</span> <span class="n">mean_tpr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span></span>
<span id="690">         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean ROC (area = </span><span class="si">%0.2f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">mean_auc</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span></span>
<span id="691"></span>
<span id="692"><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span></span>
<span id="693"><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span></span>
<span id="694"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span></span>
<span id="695"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span></span>
<span id="696"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Receiver Operating Characteristic curves&#39;</span><span class="p">)</span></span>
<span id="697"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span></span>
<span id="698"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
<span id="699"></span>
<span id="700"></span>
<span id="701"><span class="c1"># ### Feature importance</span></span>
<span id="702"><span class="c1"># The plot below suggests that two features, **Number of Latrines** and **Water Capacity in L**, are informative in this classification task.</span></span>
<span id="703"></span>
<span id="704"><span class="c1"># In[61]:</span></span>
<span id="705"></span>
<span id="706"></span>
<span id="707"><span class="n">coeff_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span></span>
<span id="708"><span class="n">coeff_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span></span>
<span id="709"><span class="n">coeff_df</span><span class="p">[</span><span class="s2">&quot;Correlation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">random_forest</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)</span></span>
<span id="710"></span>
<span id="711"><span class="nb">print</span><span class="p">((</span><span class="n">coeff_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Correlation&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span></span>
<span id="712"></span>
<span id="713"><span class="n">importances</span> <span class="o">=</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">feature_importances_</span></span>
<span id="714"><span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span></span>
<span id="715">             <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></span>
<span id="716"><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></span>
<span id="717"></span>
<span id="718"><span class="c1"># # Print the feature ranking</span></span>
<span id="719"><span class="c1"># print(&quot;Feature ranking:&quot;)</span></span>
<span id="720"></span>
<span id="721"><span class="c1"># for f in range(x_train.shape[1]):</span></span>
<span id="722"><span class="c1">#     print(&quot;%d. feature %d (%f)&quot; % (f + 1, indices[f], importances[indices[f]]))</span></span>
<span id="723"></span>
<span id="724"><span class="c1"># Plot the feature importances of the forest</span></span>
<span id="725"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span></span>
<span id="726"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Feature importances&quot;</span><span class="p">)</span></span>
<span id="727"><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span></span>
<span id="728">       <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">std</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span></span>
<span id="729"><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">x_train</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span></span>
<span id="730"><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span></span>
<span id="731"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Correlation&#39;</span><span class="p">)</span></span>
<span id="732"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
<span id="733"></span>
<span id="734"></span>
<span id="735"><span class="c1"># In[ ]:</span></span>
</pre></div>
</td></tr></table></body>
</html>
